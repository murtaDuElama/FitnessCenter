@using FitnessCenter.Models
@model IEnumerable<Antrenor>

@{
    var hizmet = ViewBag.Hizmet as Hizmet;
}

<h2 class="mb-3">@hizmet?.Ad hizmetini veren eğitmenler</h2>

<div id="trainerList">
    <!-- Sunucu tarafı fallback (JS kapalıysa) -->
    @foreach (var a in Model)
    {
        <div class="card p-3 my-2">
            <h4>@a.AdSoyad (@a.Uzmanlik)</h4>
            <a class="btn btn-primary" href="/Randevu/SelectTime?hizmetId=@hizmet?.Id&antrenorId=@a.Id">
                Müsait Saatleri Gör
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
        (function () {
            const hizmetId = @((hizmet?.Id) ?? 0);
            if (!hizmetId) return;

            fetch(`/api/antrenorler?hizmetId=${hizmetId}`)
                .then(r => r.ok ? r.json() : Promise.reject(r))
                .then(data => {
                    const list = document.getElementById('trainerList');
                    if (!list) return;

                    if (!Array.isArray(data) || data.length === 0) {
                        list.innerHTML = `<div class="alert alert-warning">Bu hizmet için uygun antrenör bulunamadı.</div>`;
                        return;
                    }

                    list.innerHTML = data.map(a => {
                        const foto = a.fotografUrl ? `<img src="${a.fotografUrl}" alt="${a.adSoyad}" class="rounded-circle me-2" style="width: 44px; height: 44px; object-fit: cover;" />` : '';
                        return `
                            <div class="card p-3 my-2">
                                <div class="d-flex align-items-center mb-2">${foto}<h4 class="mb-0">${a.adSoyad} <small class="text-muted">(${a.uzmanlik})</small></h4></div>
                                <a class="btn btn-primary" href="/Randevu/SelectTime?hizmetId=${hizmetId}&antrenorId=${a.id}">Müsait Saatleri Gör</a>
                            </div>
                        `;
                    }).join('');
                })
                .catch(() => {
                    // Fallback: Server-side list kalsın
                });
        })();
    </script>
}
